<!-- 文本编辑器 -->
<template>
	<div id="editor-wrapper" v-if="editor&&provider">
		{{ provider.status }}
		<div class="mask"></div>
		<!-- 气泡菜单 除了样式不要乱改 -->
		<bubble-menu :editor="editor" class="editor-bubble-menu">
			<div v-if="editor.isActive('codeBlock') === false">
				<button @click="editor.chain().focus().toggleBold().run()"
					:disabled="!editor.can().chain().focus().toggleBold().run()"
					:class="{ 'is-active': editor.isActive('bold') }">
					加粗
				</button>
				<button @click="editor.chain().focus().toggleItalic().run()"
					:disabled="!editor.can().chain().focus().toggleItalic().run()"
					:class="{ 'is-active': editor.isActive('italic') }">
					倾斜
				</button>
				<button @click="editor.chain().focus().toggleStrike().run()"
					:disabled="!editor.can().chain().focus().toggleStrike().run()"
					:class="{ 'is-active': editor.isActive('strike') }">
					划掉
				</button>
				<button @click="editor.chain().focus().toggleUnderline().run()"
					:disabled="!editor.can().chain().focus().toggleUnderline().run()"
					:class="{ 'is-active': editor.isActive('underline') }">
					下划线
				</button>
				<select v-model="selectedFontFamily" @change="changeFont"
					:style="{ 'font-family': `${selectedFontFamily}` }">
					<option v-for="fontOption in fontOptions" :value="fontOption.value" :key="fontOption.value"
						:style="{ 'font-family': `${fontOption.label}` }">
						{{ fontOption.label }}
					</option>
				</select>
			</div>
		</bubble-menu>
		<!-- 悬浮菜单 -->
		<floating-menu :editor="editor" class="editor-floating-menu">
			<button @click="editor.chain().focus().toggleHeading({ level: 1 }).run()"
				:class="{ 'is-active': editor.isActive('heading', { level: 1 }) }">
				h1
			</button>
			<button @click="editor.chain().focus().toggleHeading({ level: 2 }).run()"
				:class="{ 'is-active': editor.isActive('heading', { level: 2 }) }">
				h2
			</button>
			<button @click="editor.chain().focus().toggleHeading({ level: 3 }).run()"
				:class="{ 'is-active': editor.isActive('heading', { level: 3 }) }">
				h3
			</button>
			<button @click="editor.chain().focus().toggleCodeBlock().run()"
				:class="{ 'is-active': editor.isActive('codeBlock') }">
				代码块
			</button>
			<button @click="editor.chain().focus().toggleBlockquote().run()"
				:class="{ 'is-active': editor.isActive('blockquote') }">
				块引用
			</button>
		</floating-menu>
		<!-- 顶部工具栏 -->
		<div class="editor-bar" v-show="!isReadOnly">
			<div class="saves">
				<!-- 保存为PDF -->
				<button @click="exportAsPDF">
					<svg t="1693118097402" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="8774" width="50" height="50">
						<path fill="rgba(199,29,35, 1)"
							d="M531.3 574.4l0.3-1.4c5.8-23.9 13.1-53.7 7.4-80.7-3.8-21.3-19.5-29.6-32.9-30.2-15.8-0.7-29.9 8.3-33.4 21.4-6.6 24-0.7 56.8 10.1 98.6-13.6 32.4-35.3 79.5-51.2 107.5-29.6 15.3-69.3 38.9-75.2 68.7-1.2 5.5 0.2 12.5 3.5 18.8 3.7 7 9.6 12.4 16.5 15 3 1.1 6.6 2 10.8 2 17.6 0 46.1-14.2 84.1-79.4 5.8-1.9 11.8-3.9 17.6-5.9 27.2-9.2 55.4-18.8 80.9-23.1 28.2 15.1 60.3 24.8 82.1 24.8 21.6 0 30.1-12.8 33.3-20.5 5.6-13.5 2.9-30.5-6.2-39.6-13.2-13-45.3-16.4-95.3-10.2-24.6-15-40.7-35.4-52.4-65.8zM421.6 726.3c-13.9 20.2-24.4 30.3-30.1 34.7 6.7-12.3 19.8-25.3 30.1-34.7z m87.6-235.5c5.2 8.9 4.5 35.8 0.5 49.4-4.9-19.9-5.6-48.1-2.7-51.4 0.8 0.1 1.5 0.7 2.2 2z m-1.6 120.5c10.7 18.5 24.2 34.4 39.1 46.2-21.6 4.9-41.3 13-58.9 20.2-4.2 1.7-8.3 3.4-12.3 5 13.3-24.1 24.4-51.4 32.1-71.4z m155.6 65.5c0.1 0.2 0.2 0.5-0.4 0.9h-0.2l-0.2 0.3c-0.8 0.5-9 5.3-44.3-8.6 40.6-1.9 45 7.3 45.1 7.4z"
							p-id="8775"></path>
						<path fill="rgba(199,29,35, 1)"
							d="M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326z m1.8 562H232V136h302v216c0 23.2 18.8 42 42 42h216v494z"
							p-id="8776"></path>
					</svg>
				</button>
				<!-- 保存为Word -->
				<button @click="exportAsWord">
					<svg t="1693118041836" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="8597" width="50" height="50">
						<path fill="#195cbe"
							d="M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326z m1.8 562H232V136h302v216c0 23.2 18.8 42 42 42h216v494z"
							p-id="8598"></path>
						<path fill="#195cbe"
							d="M528.1 472h-32.2c-5.5 0-10.3 3.7-11.6 9.1L434.6 680l-46.1-198.7c-1.3-5.4-6.1-9.3-11.7-9.3h-35.4c-1.1 0-2.1 0.1-3.1 0.4-6.4 1.7-10.2 8.3-8.5 14.7l74.2 276c1.4 5.2 6.2 8.9 11.6 8.9h32c5.4 0 10.2-3.6 11.6-8.9l52.8-197 52.8 197c1.4 5.2 6.2 8.9 11.6 8.9h31.8c5.4 0 10.2-3.6 11.6-8.9l74.4-276c0.3-1 0.4-2.1 0.4-3.1 0-6.6-5.4-12-12-12H647c-5.6 0-10.4 3.9-11.7 9.3l-45.8 199.1-49.8-199.3c-1.3-5.4-6.1-9.1-11.6-9.1z"
							p-id="8599"></path>
					</svg>
				</button>
				<!-- 云端保存 -->
				<button @click="saveDocument('manualsave')">
					<svg t="1693118573501" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="8970" width="50" height="50">
						<path fill="#01c6d9"
							d="M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184z m456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840z"
							p-id="8971"></path>
						<path fill="#01c6d9"
							d="M512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144z m0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"
							p-id="8972"></path>
					</svg>
				</button>
			</div>
			<div class="font">
				<div class="font-top">
					<select class="font-select" v-model="selectedFontFamily" @change="changeFont"
						:style="{ 'font-family': `${selectedFontFamily}` }">
						<option v-for="fontOption in  fontOptions" :value="fontOption.value" :key="fontOption.value"
							:style="{ 'font-family': `${fontOption.label}` }">
							{{ fontOption.label }}
						</option>
					</select>
					<!-- 拾色器 -->
					<div class="color-input">

						<!-- <n-color-picker 
								v-model:value="editor.getAttributes('textStyle').color" 
								:show-alpha="false"
								@update:value="(value) => { editor.chain().focus().setColor(value).run() }"
								:style="{'--n-text-color': 'rgba(1,1,1,0)'}"
							/> -->

						<input type="color" @input="editor.chain().focus().setColor($event.target.value).run()"
							:value="editor.getAttributes('textStyle').color">
					</div>
				</div>
				<div class="font-bottom">
					<!-- 加粗 B -->
					<button @click="editor.chain().focus().toggleBold().run()"
						:disabled="!editor.can().chain().focus().toggleBold().run()"
						:class="{ 'is-active': editor.isActive('bold') }">
						<svg t="1693120857543" class="icon" viewBox="0 0 1024 1024" version="1.1"
							xmlns="http://www.w3.org/2000/svg" p-id="10125" width="20" height="20">
							<path
								d="M385.692278 918.576916 390.80771 919.307658C421.012953 920.769221 443.423035 921.499963 458.03843 921.499963 545.73119 921.499963 609.551045 905.545019 649.499963 873.63458 689.448881 841.724219 709.423104 790.449073 709.423104 719.807724 709.423104 655.986846 690.66689 608.365568 653.153831 576.942316 615.640852 545.519065 559.372209 529.807675 484.346171 529.807675 462.422961 529.807675 444.153935 530.051308 429.538462 530.538496 414.922988 531.025605 400.307751 531.756426 385.692278 532.730801L385.692278 918.576916ZM386.423099 445.769255C390.320522 446.256443 395.192241 446.621775 401.038494 446.865408 406.884667 447.108962 415.410176 447.23074 426.615414 447.23074 504.5645 447.23074 561.929295 431.51935 598.711532 400.096177 635.49377 368.672926 653.884652 319.590085 653.884652 252.846159 653.884652 194.384345 636.833477 151.025822 602.730732 122.76925 568.628066 94.512679 516.256768 80.38463 445.615419 80.38463 433.922993 80.38463 415.410412 81.358927 390.076889 83.307678L385.692278 83.307678 386.423099 445.769255ZM78.769231 0 528.192276 0C638.295434 0 721.115136 19.608812 776.653824 58.82691 832.192591 98.045086 859.961502 156.62781 859.961502 234.576896 859.961502 293.525898 841.936108 342.852372 805.884613 382.557657 769.833118 422.26302 716.731156 451.371717 646.576916 469.884613 732.320926 471.346176 799.063828 493.268992 846.80767 535.653849 894.551513 578.038705 918.423079 636.499653 918.423079 711.038425 918.423079 805.551734 886.026004 878.018954 821.23075 928.442289 756.435574 978.865625 663.141612 1004.076898 541.346186 1004.076898L78.769231 1004.076898 78.769231 931.000005 167.19234 922.961526 191.307697 899.576911 191.307697 101.57694 167.19234 80.38463 78.769231 73.076894 78.769231 0Z"
								fill="#000000" p-id="10126"></path>
						</svg>
					</button>
					<!-- 斜体 I -->
					<button @click="editor.chain().focus().toggleItalic().run()"
						:disabled="!editor.can().chain().focus().toggleItalic().run()"
						:class="{ 'is-active': editor.isActive('italic') }">
						<svg t="1693059386616" class="icon" viewBox="0 0 1024 1024" version="1.1"
							xmlns="http://www.w3.org/2000/svg" p-id="2334" width="20" height="20">
							<path
								d="M760.198095 97.52381v73.142857h-127.804952l-189.464381 707.047619h146.627048v73.142857H243.809524v-73.142857h123.392l189.44-707.047619H414.47619V97.52381h345.721905z"
								p-id="2335"></path>
						</svg>
					</button>
					<!-- 删除线 -->
					<button @click="editor.chain().focus().toggleStrike().run()"
						:disabled="!editor.can().chain().focus().toggleStrike().run()"
						:class="{ 'is-active': editor.isActive('strike') }">
						<svg t="1693059874309" class="icon" viewBox="0 0 1024 1024" version="1.1"
							xmlns="http://www.w3.org/2000/svg" p-id="3819" width="20" height="20">
							<path
								d="M756.037818 539.624727c61.998545 40.634182 93.486545 96.977455 93.486546 169.053091 0 71.493818-30.487273 128.954182-90.274909 171.194182-57.437091 39.796364-133.632 59.764364-228.584728 59.764364-96.116364 0-172.334545-22.272-227.421091-65.629091-63.301818-50.408727-98.443636-126.650182-105.495272-227.421091h70.330181c8.215273 78.498909 35.165091 137.146182 82.059637 175.825454 42.193455 34.001455 102.004364 51.595636 179.362909 51.595637 73.844364 0 133.632-15.290182 179.339636-43.426909 44.544-29.253818 68.002909-69.12 68.002909-118.365091 0-57.437091-29.323636-101.981091-85.597091-133.632-18.338909-10.705455-50.641455-23.901091-97.256727-38.958546H221.090909a34.909091 34.909091 0 0 1 0-69.818182h145.105455c-22.853818-8.448-39.959273-15.965091-51.2-22.528-64.512-36.328727-96.162909-89.088-96.162909-157.044363 0-72.680727 29.323636-127.790545 90.298181-166.469818C363.008 87.412364 433.338182 69.818182 517.748364 69.818182c91.461818 0 164.119273 22.272 218.018909 66.816 55.109818 44.544 86.760727 110.173091 93.789091 196.957091h-71.517091c-9.355636-65.629091-33.978182-114.874182-73.844364-148.875637-39.866182-34.001455-96.116364-50.408727-168.797091-50.408727-68.002909 0-120.738909 11.729455-159.418182 35.141818-44.544 25.832727-65.629091 65.675636-65.629091 118.411637 0 46.917818 25.762909 83.223273 78.49891 111.36 24.669091 11.729455 78.545455 30.510545 160.628363 53.922909 20.014545 5.725091 38.772364 11.264 56.32 16.663272H826.181818a34.909091 34.909091 0 0 1 0 69.818182h-70.144z"
								p-id="3820"></path>
						</svg>
					</button>
					<!-- 下划线 -->
					<button @click="editor.chain().focus().toggleUnderline().run()"
						:disabled="!editor.can().chain().focus().toggleUnderline().run()"
						:class="{ 'is-active': editor.isActive('underline') }">
						<svg t="1693059944194" class="icon" viewBox="0 0 1024 1024" version="1.1"
							xmlns="http://www.w3.org/2000/svg" p-id="4797" width="20" height="20">
							<path
								d="M360.423619 85.333333v73.142857H280.380952v319.561143c0 118.662095 99.718095 215.942095 224.889905 219.331048l6.729143 0.097524c128.292571 0 231.619048-98.645333 231.619048-219.428572V158.47619H658.285714v-73.142857h238.518857v73.142857H816.761905v319.561143c0 159.50019-132.705524 288.597333-297.155048 292.473905l-7.606857 0.097524c-167.936 0-304.761905-130.608762-304.761905-292.571429V158.47619H121.904762v-73.142857h238.518857zM170.666667 902.095238h685.007238v-73.142857H170.666667v73.142857z"
								p-id="4798"></path>
						</svg>
					</button>
				</div>
			</div>

			<div class="temp-container">
				<!-- 编辑模式 -->
				<button @click="editable = !editable" :class="{ 'is-active': editable }">
					<svg v-if="editable" t="1693118301113" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="8575" width="20" height="20">
						<path
							d="M257.7 752c2 0 4-0.2 6-0.5L431.9 722c2-0.4 3.9-1.3 5.3-2.8l423.9-423.9c3.9-3.9 3.9-10.2 0-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2c-1.9 11.1 1.5 21.9 9.4 29.8 6.6 6.4 14.9 9.9 23.8 9.9z m67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"
							p-id="8576"></path>
					</svg>
					<svg v-else t="1693118340836" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="8751" width="20" height="20">
						<path
							d="M928 161H699.2c-49.1 0-97.1 14.1-138.4 40.7L512 233l-48.8-31.3C422 175.1 373.9 161 324.8 161H96c-17.7 0-32 14.3-32 32v568c0 17.7 14.3 32 32 32h228.8c49.1 0 97.1 14.1 138.4 40.7l44.4 28.6c1.3 0.8 2.8 1.3 4.3 1.3s3-0.4 4.3-1.3l44.4-28.6C602 807.1 650.1 793 699.2 793H928c17.7 0 32-14.3 32-32V193c0-17.7-14.3-32-32-32zM324.8 721H136V233h188.8c35.4 0 69.8 10.1 99.5 29.2l48.8 31.3 6.9 4.5v462c-47.6-25.6-100.8-39-155.2-39z m563.2 0H699.2c-54.4 0-107.6 13.4-155.2 39V298l6.9-4.5 48.8-31.3c29.7-19.1 64.1-29.2 99.5-29.2H888v488z"
							p-id="8752"></path>
						<path
							d="M396.9 361H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0.1-4.1-3.1-7.5-7-7.5zM620 368.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0-4.1-3.2-7.5-7.1-7.5H627.1c-3.9 0-7.1 3.4-7.1 7.5zM396.9 501H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0.1-4.1-3.1-7.5-7-7.5zM812.9 501H627.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0.1-4.1-3.1-7.5-7-7.5z"
							p-id="8753"></path>
					</svg>
				</button>

				<!--  -->
				<slot name="showHistoryButton"></slot>

				<!-- 行内代码 -->
				<button @click="editor.chain().focus().toggleCode().run()"
					:disabled="!editor.can().chain().focus().toggleCode().run()"
					:class="{ 'is-active': editor.isActive('code') }">
					<svg t="1693060809541" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="14588" width="20" height="20">
						<path
							d="M320 320L256 256 0 512.64 256 768l64-64-192-192 192-192zM768 256l-64 64 192 192-192 192 64 64 256-255.36L768 256zM353.28 896h96l224-768h-96l-224 768z"
							fill="#262626" p-id="14589"></path>
					</svg>
				</button>
				<!-- 代码块 -->
				<button ref="a" @click="editor.chain().focus().toggleCodeBlock().run()"
					:class="{ 'is-active': editor.isActive('codeBlock') }">
					<svg t="1693060851190" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="14739" width="20" height="20">
						<path
							d="M213.344 192v213.344c0 32-66.144 64-85.344 64v85.344c19.2 0 85.344 32 85.344 64v213.344A105.6 105.6 0 0 0 320 938.688h85.344v-85.344H320c-12.8 0-21.344-8.544-21.344-21.344v-213.344c0-44.8-27.744-81.056-59.744-106.656 34.144-25.6 59.744-61.856 59.744-106.656V192c0-12.8 8.544-21.344 21.344-21.344h85.344V85.312H320a105.6 105.6 0 0 0-106.656 106.656zM810.656 405.344V192A105.6 105.6 0 0 0 704 85.344h-85.344v85.344H704c12.8 0 21.344 8.544 21.344 21.344v213.344c0 44.8 27.744 81.056 59.744 106.656-34.144 25.6-59.744 61.856-59.744 106.656v213.344c0 12.8-8.544 21.344-21.344 21.344h-85.344v85.344H704a105.6 105.6 0 0 0 106.656-106.656v-213.344c0-32 66.144-64 85.344-64v-85.344c-19.2 0-85.344-32-85.344-64z"
							p-id="14740"></path>
					</svg>
				</button>
				<!-- 橙色强调 #ffc078 -->
				<button @click="editor.chain().focus().toggleHighlight({ color: '#ffc078' }).run()"
					:class="{ 'is-active': editor.isActive('highlight', { color: '#ffc078' }) }">
					<svg t="1693060307610" class="icon" viewBox="0 0 1025 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="13261" width="20" height="20">
						<path
							d="M1016.525 493.875c-9.984-9.984-26.215-9.984-36.199 0L796.723 677.478c-29.952 29.952-78.694 29.952-108.595 0L448.922 438.272c-14.439-14.438-22.375-33.69-22.375-54.323s7.936-39.885 22.375-54.323l183.603-183.604c9.984-9.984 9.984-26.214 0-36.198s-26.215-9.984-36.199 0L412.723 293.427c-24.115 24.115-37.376 56.218-37.376 90.522 0 14.592 2.458 28.825 7.066 42.189L7.526 801.024C2.714 805.837 0.051 812.339 0.051 819.149v76.8c0 14.131 11.469 25.6 25.6 25.6h486.4c6.81 0 13.312-2.714 18.125-7.475l170.086-170.087c13.364 4.66 27.597 7.066 42.19 7.066 34.252 0 66.406-13.261 90.52-37.376l183.604-183.603c9.984-9.984 9.984-26.215 0-36.199zM501.402 870.4H51.2v-40.602l358.502-358.502c1.024 1.075 1.997 2.15 3.021 3.174L651.93 713.677a88.439 88.439 0 0 0 3.174 3.02L501.402 870.4z"
							p-id="13262" fill="#ffc178"></path>
					</svg>
				</button>
				<!-- 绿色强调 #8ce99a -->
				<button @click="editor.chain().focus().toggleHighlight({ color: '#8ce99a' }).run()"
					:class="{ 'is-active': editor.isActive('highlight', { color: '#8ce99a' }) }">
					<svg t="1693060307610" class="icon" viewBox="0 0 1025 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="13261" width="20" height="20">
						<path
							d="M1016.525 493.875c-9.984-9.984-26.215-9.984-36.199 0L796.723 677.478c-29.952 29.952-78.694 29.952-108.595 0L448.922 438.272c-14.439-14.438-22.375-33.69-22.375-54.323s7.936-39.885 22.375-54.323l183.603-183.604c9.984-9.984 9.984-26.214 0-36.198s-26.215-9.984-36.199 0L412.723 293.427c-24.115 24.115-37.376 56.218-37.376 90.522 0 14.592 2.458 28.825 7.066 42.189L7.526 801.024C2.714 805.837 0.051 812.339 0.051 819.149v76.8c0 14.131 11.469 25.6 25.6 25.6h486.4c6.81 0 13.312-2.714 18.125-7.475l170.086-170.087c13.364 4.66 27.597 7.066 42.19 7.066 34.252 0 66.406-13.261 90.52-37.376l183.604-183.603c9.984-9.984 9.984-26.215 0-36.199zM501.402 870.4H51.2v-40.602l358.502-358.502c1.024 1.075 1.997 2.15 3.021 3.174L651.93 713.677a88.439 88.439 0 0 0 3.174 3.02L501.402 870.4z"
							p-id="13262" fill="#8ce99a"></path>
					</svg>
				</button>
				<!-- 蓝色强调 #74c0fc -->
				<button @click="editor.chain().focus().toggleHighlight({ color: '#74c0fc' }).run()"
					:class="{ 'is-active': editor.isActive('highlight', { color: '#74c0fc' }) }">
					<svg t="1693060307610" class="icon" viewBox="0 0 1025 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="13261" width="20" height="20">
						<path
							d="M1016.525 493.875c-9.984-9.984-26.215-9.984-36.199 0L796.723 677.478c-29.952 29.952-78.694 29.952-108.595 0L448.922 438.272c-14.439-14.438-22.375-33.69-22.375-54.323s7.936-39.885 22.375-54.323l183.603-183.604c9.984-9.984 9.984-26.214 0-36.198s-26.215-9.984-36.199 0L412.723 293.427c-24.115 24.115-37.376 56.218-37.376 90.522 0 14.592 2.458 28.825 7.066 42.189L7.526 801.024C2.714 805.837 0.051 812.339 0.051 819.149v76.8c0 14.131 11.469 25.6 25.6 25.6h486.4c6.81 0 13.312-2.714 18.125-7.475l170.086-170.087c13.364 4.66 27.597 7.066 42.19 7.066 34.252 0 66.406-13.261 90.52-37.376l183.604-183.603c9.984-9.984 9.984-26.215 0-36.199zM501.402 870.4H51.2v-40.602l358.502-358.502c1.024 1.075 1.997 2.15 3.021 3.174L651.93 713.677a88.439 88.439 0 0 0 3.174 3.02L501.402 870.4z"
							p-id="13262" fill="#74c0fc"></path>
					</svg>
				</button>
				<!-- 紫色强调 #b197fc -->
				<button @click="editor.chain().focus().toggleHighlight({ color: '#b197fc' }).run()"
					:class="{ 'is-active': editor.isActive('highlight', { color: '#b197fc' }) }">
					<svg t="1693060307610" class="icon" viewBox="0 0 1025 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="13261" width="20" height="20">
						<path
							d="M1016.525 493.875c-9.984-9.984-26.215-9.984-36.199 0L796.723 677.478c-29.952 29.952-78.694 29.952-108.595 0L448.922 438.272c-14.439-14.438-22.375-33.69-22.375-54.323s7.936-39.885 22.375-54.323l183.603-183.604c9.984-9.984 9.984-26.214 0-36.198s-26.215-9.984-36.199 0L412.723 293.427c-24.115 24.115-37.376 56.218-37.376 90.522 0 14.592 2.458 28.825 7.066 42.189L7.526 801.024C2.714 805.837 0.051 812.339 0.051 819.149v76.8c0 14.131 11.469 25.6 25.6 25.6h486.4c6.81 0 13.312-2.714 18.125-7.475l170.086-170.087c13.364 4.66 27.597 7.066 42.19 7.066 34.252 0 66.406-13.261 90.52-37.376l183.604-183.603c9.984-9.984 9.984-26.215 0-36.199zM501.402 870.4H51.2v-40.602l358.502-358.502c1.024 1.075 1.997 2.15 3.021 3.174L651.93 713.677a88.439 88.439 0 0 0 3.174 3.02L501.402 870.4z"
							p-id="13262" fill="#b197fc"></path>
					</svg>
				</button>
				<!-- 深红色强调 #cd4444 -->
				<button @click="editor.chain().focus().toggleHighlight({ color: '#ce4444' }).run()"
					:class="{ 'is-active': editor.isActive('highlight', { color: '#ce4444' }) }">
					<svg t="1693060307610" class="icon" viewBox="0 0 1025 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="13261" width="20" height="20">
						<path
							d="M1016.525 493.875c-9.984-9.984-26.215-9.984-36.199 0L796.723 677.478c-29.952 29.952-78.694 29.952-108.595 0L448.922 438.272c-14.439-14.438-22.375-33.69-22.375-54.323s7.936-39.885 22.375-54.323l183.603-183.604c9.984-9.984 9.984-26.214 0-36.198s-26.215-9.984-36.199 0L412.723 293.427c-24.115 24.115-37.376 56.218-37.376 90.522 0 14.592 2.458 28.825 7.066 42.189L7.526 801.024C2.714 805.837 0.051 812.339 0.051 819.149v76.8c0 14.131 11.469 25.6 25.6 25.6h486.4c6.81 0 13.312-2.714 18.125-7.475l170.086-170.087c13.364 4.66 27.597 7.066 42.19 7.066 34.252 0 66.406-13.261 90.52-37.376l183.604-183.603c9.984-9.984 9.984-26.215 0-36.199zM501.402 870.4H51.2v-40.602l358.502-358.502c1.024 1.075 1.997 2.15 3.021 3.174L651.93 713.677a88.439 88.439 0 0 0 3.174 3.02L501.402 870.4z"
							p-id="13262" fill="#cd4444"></path>
					</svg>
				</button>
				<!-- 浅红色强调 #ee9999-->
				<button @click="editor.chain().focus().toggleHighlight({ color: '#ee9999' }).run()"
					:class="{ 'is-active': editor.isActive('highlight', { color: '#ee9999' }) }">
					<svg t="1693060307610" class="icon" viewBox="0 0 1025 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="13261" width="20" height="20">
						<path
							d="M1016.525 493.875c-9.984-9.984-26.215-9.984-36.199 0L796.723 677.478c-29.952 29.952-78.694 29.952-108.595 0L448.922 438.272c-14.439-14.438-22.375-33.69-22.375-54.323s7.936-39.885 22.375-54.323l183.603-183.604c9.984-9.984 9.984-26.214 0-36.198s-26.215-9.984-36.199 0L412.723 293.427c-24.115 24.115-37.376 56.218-37.376 90.522 0 14.592 2.458 28.825 7.066 42.189L7.526 801.024C2.714 805.837 0.051 812.339 0.051 819.149v76.8c0 14.131 11.469 25.6 25.6 25.6h486.4c6.81 0 13.312-2.714 18.125-7.475l170.086-170.087c13.364 4.66 27.597 7.066 42.19 7.066 34.252 0 66.406-13.261 90.52-37.376l183.604-183.603c9.984-9.984 9.984-26.215 0-36.199zM501.402 870.4H51.2v-40.602l358.502-358.502c1.024 1.075 1.997 2.15 3.021 3.174L651.93 713.677a88.439 88.439 0 0 0 3.174 3.02L501.402 870.4z"
							p-id="13262" fill="#ee9999"></path>
					</svg>
				</button>
				<!-- 左对齐 -->
				<button @click="editor.chain().focus().setTextAlign('left').run()"
					:class="{ 'is-active': editor.isActive({ textAlign: 'left' }) }">
					<svg t="1693060081222" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="5924" width="20" height="20">
						<path
							d="M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zM120 654h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zM904 794H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM904 370H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"
							p-id="5925"></path>
					</svg>
				</button>
				<!-- 居中对齐 -->
				<button @click="editor.chain().focus().setTextAlign('center').run()"
					:class="{ 'is-active': editor.isActive({ textAlign: 'center' }) }">
					<svg t="1693060101159" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="6079" width="20" height="20">
						<path
							d="M264 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zM760 654c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496zM904 794H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM904 370H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"
							p-id="6080"></path>
					</svg>
				</button>
				<!-- 右对齐 -->
				<button @click="editor.chain().focus().setTextAlign('right').run()"
					:class="{ 'is-active': editor.isActive({ textAlign: 'right' }) }">
					<svg t="1693060134407" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="6234" width="20" height="20">
						<path
							d="M904 158H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM904 582H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM904 794H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM904 370H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"
							p-id="6235"></path>
					</svg>
				</button>
				<!-- 两端对齐 -->
				<button @click="editor.chain().focus().setTextAlign('justify').run()"
					:class="{ 'is-active': editor.isActive({ textAlign: 'justify' }) }">
					<svg t="1693060195477" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="7241" width="20" height="20">
						<path d="M0 93.090909h1024v93.137455H0z" fill="#231815" p-id="7242"></path>
						<path d="M0 332.334545h1024v93.09091H0z" fill="#231815" p-id="7243"></path>
						<path d="M0 810.821818h1024v93.090909H0z" fill="#231815" p-id="7244"></path>
						<path d="M0 571.578182h1024v93.090909H0z" fill="#231815" p-id="7245"></path>
					</svg>
				</button>

				<!-- 任务项 -->
				<button @click="editor.chain().focus().toggleTaskList().run()"
					:class="{ 'is-active': editor.isActive('taskList') }">
					<!-- {{ editor.isActive('taskList') ? '清除' : '创建' }}任务项 -->
					<svg t="1693116828891" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="13009" width="20" height="20">
						<path
							d="M936.5 213.1H360.1c-12.7 0-23-10.3-23-23s10.3-23 23-23h576.5c12.7 0 23 10.3 23 23s-10.3 23-23.1 23zM163.1 270c-6.1 0-12-2.4-16.3-6.7L73.5 190c-9-9-9-23.5 0-32.5s23.5-9 32.5 0l57 57 109.7-109.7c9-9 23.5-9 32.5 0s9 23.5 0 32.5L179.3 263.2c-4.3 4.3-10.1 6.8-16.2 6.8zM360.1 535.3c-12.7 0-23-10.3-23-23s10.3-23 23-23l576.5-0.5c12.7 0 23 10.3 23 23s-10.3 23-23 23l-576.5 0.5zM163.1 592.4c-6.1 0-11.9-2.4-16.3-6.7l-73.3-73.2c-9-9-9-23.5 0-32.5s23.5-9 32.5 0l57.1 57 109.6-109.8c9-9 23.5-9 32.5 0s9 23.5 0 32.5l-125.8 126c-4.3 4.2-10.2 6.7-16.3 6.7z"
							p-id="13010"></path>
						<path
							d="M936.5 868H360.1c-12.7 0-23-10.3-23-23s10.3-23 23-23h576.5c12.7 0 23 10.3 23 23s-10.3 23-23.1 23zM163.1 924.9c-6.1 0-12-2.4-16.3-6.7l-73.3-73.3c-9-9-9-23.5 0-32.5s23.5-9 32.5 0l57 57 109.7-109.7c9-9 23.5-9 32.5 0s9 23.5 0 32.5L179.3 918.1c-4.3 4.4-10.1 6.8-16.2 6.8z"
							p-id="13011"></path>
					</svg>
				</button>
				<!-- 任务项右缩进 -->
				<button @click="editor.chain().focus().sinkListItem('taskItem').run()"
					:disabled="!editor.can().sinkListItem('taskItem')">
					<svg t="1693117131151" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="16380" width="20" height="20">
						<path
							d="M960 981.333333H106.666667a21.333333 21.333333 0 0 1 0-42.666666h853.333333a21.333333 21.333333 0 0 1 0 42.666666z m0-213.333333H490.666667a21.333333 21.333333 0 0 1 0-42.666667h469.333333a21.333333 21.333333 0 0 1 0 42.666667zM234.666667 640a21.266667 21.266667 0 0 0 15.086666-6.246667l85.333334-85.333333a21.333333 21.333333 0 0 0 0-30.173333l-85.333334-85.333334a21.333333 21.333333 0 0 0-30.173333 30.173334L268.493333 512H106.666667a21.333333 21.333333 0 0 0 0 42.666667h161.826666l-48.913333 48.913333A21.333333 21.333333 0 0 0 234.666667 640z m725.333333-85.333333H490.666667a21.333333 21.333333 0 0 1 0-42.666667h469.333333a21.333333 21.333333 0 0 1 0 42.666667z m0-213.333334H490.666667a21.333333 21.333333 0 0 1 0-42.666666h469.333333a21.333333 21.333333 0 0 1 0 42.666666z m0-213.333333H106.666667a21.333333 21.333333 0 0 1 0-42.666667h853.333333a21.333333 21.333333 0 0 1 0 42.666667z"
							fill="#5C5C66" p-id="16381"></path>
					</svg>
				</button>
				<!-- 任务项左缩进 -->
				<button @click="editor.chain().focus().liftListItem('taskItem').run()"
					:disabled="!editor.can().liftListItem('taskItem')">
					<svg t="1693117164039" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="16535" width="20" height="20">
						<path
							d="M960 981.333333H106.666667a21.333333 21.333333 0 0 1 0-42.666666h853.333333a21.333333 21.333333 0 0 1 0 42.666666z m0-213.333333H490.666667a21.333333 21.333333 0 0 1 0-42.666667h469.333333a21.333333 21.333333 0 0 1 0 42.666667zM192 640a21.266667 21.266667 0 0 1-15.086667-6.246667l-85.333333-85.333333a21.333333 21.333333 0 0 1 0-30.173333l85.333333-85.333334a21.333333 21.333333 0 0 1 30.173334 30.173334L158.166667 512H320a21.333333 21.333333 0 0 1 0 42.666667H158.166667l48.92 48.913333A21.333333 21.333333 0 0 1 192 640z m768-85.333333H490.666667a21.333333 21.333333 0 0 1 0-42.666667h469.333333a21.333333 21.333333 0 0 1 0 42.666667z m0-213.333334H490.666667a21.333333 21.333333 0 0 1 0-42.666666h469.333333a21.333333 21.333333 0 0 1 0 42.666666z m0-213.333333H106.666667a21.333333 21.333333 0 0 1 0-42.666667h853.333333a21.333333 21.333333 0 0 1 0 42.666667z"
							fill="#5C5C66" p-id="16536"></path>
					</svg>
				</button>
				<!-- 普通段落 -->
				<button @click="editor.chain().focus().setParagraph().run()"
					:class="{ 'is-active': editor.isActive('paragraph') }">
					<svg t="1693118237112" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="10079" width="20" height="20">
						<path
							d="M960 10.581333H308.394667a297.685333 297.685333 0 1 0 0 595.370667h98.901333a10.666667 10.666667 0 0 1 10.666667 10.666667V960a53.333333 53.333333 0 0 0 106.666666 0V128a10.666667 10.666667 0 0 1 10.666667-10.666667h157.098667a10.666667 10.666667 0 0 1 10.666666 10.666667v832a53.333333 53.333333 0 0 0 106.666667 0V128a10.624 10.624 0 0 1 10.666667-10.666667H960a53.333333 53.333333 0 0 0 0-106.666666zM418.133333 488.618667a10.666667 10.666667 0 0 1-10.666666 10.666666H308.394667a191.018667 191.018667 0 1 1 0-382.037333h98.901333A10.666667 10.666667 0 0 1 418.133333 128z"
							p-id="10080"></path>
					</svg>
				</button>
				<!-- 清除标记 -->
				<button @click="editor.chain().focus().unsetAllMarks().run(); editor.chain().focus().clearNodes().run()">
					<svg t="1693060935327" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="15726" width="20" height="20">
						<path
							d="M667.257905 139.873524l3.85219 3.632762 252.903619 254.537143a73.142857 73.142857 0 0 1 0 103.107047L604.501333 822.686476H828.952381v73.142857H266.532571l-172.129523-173.226666a73.142857 73.142857 0 0 1 0-103.131429L567.344762 143.530667a73.142857 73.142857 0 0 1 99.913143-3.632762zM227.181714 589.604571L146.285714 671.036952l150.674286 151.649524h163.303619l-233.081905-233.081905zM619.227429 195.047619L278.747429 537.721905l253.70819 253.70819 339.675429-341.820952L619.227429 195.047619z"
							p-id="15727"></path>
					</svg>
				</button>
				<!-- 暂不清楚清楚节点和标记的区别，将其 @click 一并放到上面 -->
				<!-- <button @click="editor.chain().focus().clearNodes().run()">
					清除节点
				</button> -->
				<!-- h1 -->
				<button @click="editor.chain().focus().toggleHeading({ level: 1 }).run()"
					:class="{ 'is-active': editor.isActive('heading', { level: 1 }) }">
					<svg t="1693061041243" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="1321" width="20" height="20">
						<path
							d="M584.9 445.3V142.6h86.5v735h-86.5V531.7H152.5v345.9H66.1v-735h86.5v302.6l432.3 0.1zM843.7 877.6v-0.3h-79.8V826h79.8V558.6c-22.5 23.4-49.9 40.4-79.8 49.3v-59.1c17.2-5.2 33.8-12.9 49.1-23 16.2-10.6 30.9-23.7 43.9-38.9h39.9V826h61.7v51.3h-61.7v0.3h-53.1z"
							p-id="1322"></path>
					</svg>
				</button>
				<!-- h2 -->
				<button @click="editor.chain().focus().toggleHeading({ level: 2 }).run()"
					:class="{ 'is-active': editor.isActive('heading', { level: 2 }) }">
					<svg t="1693061118323" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="1479" width="20" height="20">
						<path
							d="M88 448h400V172c0-24.3 19.7-44 44-44s44 19.7 44 44v680c0 24.3-19.7 44-44 44s-44-19.7-44-44V536H88v316c0 24.3-19.7 44-44 44S0 876.3 0 852V172c0-24.3 19.7-44 44-44s44 19.7 44 44v276z m935.282 448H680c0.479-41.591 10.533-77.923 30.163-108.997 19.63-31.074 46.44-58.084 80.434-81.031 16.279-11.952 33.275-23.544 50.99-34.779 17.714-11.234 33.993-23.305 48.835-36.213 14.842-12.907 27.05-26.89 36.626-41.95 9.576-15.058 14.603-32.388 15.081-51.988 0-9.083-1.077-18.764-3.231-29.042-2.155-10.278-6.344-19.84-12.568-28.683-6.224-8.845-14.842-16.254-25.854-22.23-11.012-5.976-25.375-8.964-43.09-8.964-16.278 0-29.803 3.227-40.576 9.68-10.772 6.455-19.39 15.299-25.854 26.533-6.463 11.235-11.251 24.5-14.363 39.798-3.112 15.298-4.908 31.791-5.386 49.48h-81.87c0-27.728 3.71-53.423 11.13-77.087 7.422-23.664 18.553-44.101 33.395-61.311 14.842-17.21 32.916-30.715 54.222-40.516 21.305-9.8 46.081-14.7 74.33-14.7 30.641 0 56.255 5.02 76.843 15.059 20.587 10.04 37.224 22.707 49.912 38.005 12.688 15.298 21.665 31.91 26.931 49.838 5.267 17.927 7.9 35.018 7.9 51.272 0 20.078-3.112 38.244-9.336 54.498-6.224 16.254-14.603 31.193-25.136 44.818-10.533 13.625-22.502 26.174-35.908 37.647a538.302 538.302 0 0 0-41.653 32.27 1122.27 1122.27 0 0 0-43.09 28.683c-14.364 9.083-27.65 18.166-39.858 27.249-12.209 9.083-22.862 18.525-31.958 28.325-9.097 9.8-15.321 20.198-18.673 31.193h244.894V896z"
							p-id="1480"></path>
					</svg>
				</button>
				<!-- h3 -->
				<button @click="editor.chain().focus().toggleHeading({ level: 3 }).run()"
					:class="{ 'is-active': editor.isActive('heading', { level: 3 }) }">
					<svg t="1693061135842" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="1633" width="20" height="20">
						<path
							d="M88 448h400V172c0-24.3 19.7-44 44-44s44 19.7 44 44v680c0 24.3-19.7 44-44 44s-44-19.7-44-44V536H88v316c0 24.3-19.7 44-44 44S0 876.3 0 852V172c0-24.3 19.7-44 44-44s44 19.7 44 44v276zM815.551 597.802c13.128 0.47 26.257-0.469 39.385-2.813 13.129-2.344 24.85-6.447 35.165-12.308 10.316-5.86 18.638-13.948 24.968-24.263 6.33-10.315 9.494-22.975 9.494-37.978 0-21.1-7.15-37.978-21.45-50.638-14.301-12.66-32.704-18.989-55.21-18.989-14.066 0-26.257 2.813-36.572 8.44-10.315 5.626-18.872 13.245-25.67 22.857-6.799 9.612-11.84 20.395-15.121 32.352-3.283 11.956-4.69 24.263-4.22 36.923h-80.177c0.938-23.913 5.392-46.066 13.363-66.462 7.97-20.396 18.872-38.095 32.703-53.099 13.832-15.004 30.594-26.725 50.287-35.165C802.188 388.22 824.459 384 849.31 384c19.223 0 38.095 2.813 56.616 8.44 18.52 5.626 35.165 13.831 49.934 24.615 14.77 10.784 26.609 24.498 35.517 41.143 8.909 16.645 13.363 35.75 13.363 57.318 0 24.85-5.626 46.535-16.88 65.055-11.252 18.52-28.835 32-52.747 40.44v1.407c28.132 5.626 50.052 19.575 65.759 41.846 15.707 22.27 23.56 49.348 23.56 81.23 0 23.444-4.688 44.425-14.065 62.946-9.378 18.52-22.037 34.227-37.979 47.12-15.942 12.894-34.462 22.858-55.561 29.89-21.1 7.034-43.37 10.55-66.814 10.55-28.601 0-53.568-4.103-74.902-12.308-21.334-8.205-39.15-19.81-53.451-34.813-14.3-15.004-25.202-33.055-32.704-54.154-7.502-21.099-11.487-44.542-11.956-70.33h80.177c-0.938 30.008 6.447 54.975 22.154 74.902s39.268 29.89 70.682 29.89c26.726 0 49.114-7.62 67.166-22.857 18.051-15.239 27.077-36.923 27.077-65.055 0-19.224-3.751-34.462-11.253-45.715-7.502-11.252-17.348-19.81-29.539-25.67-12.19-5.86-25.905-9.494-41.143-10.901-15.239-1.407-30.828-1.875-46.77-1.407v-59.78z"
							p-id="1634"></path>
					</svg>
				</button>
				<!-- h4 -->
				<button @click="editor.chain().focus().toggleHeading({ level: 4 }).run()"
					:class="{ 'is-active': editor.isActive('heading', { level: 4 }) }">
					<svg t="1693061157475" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="1787" width="20" height="20">
						<path
							d="M88 448h400V172c0-24.3 19.7-44 44-44s44 19.7 44 44v680c0 24.3-19.7 44-44 44s-44-19.7-44-44V536H88v316c0 24.3-19.7 44-44 44S0 876.3 0 852V172c0-24.3 19.7-44 44-44s44 19.7 44 44v276z m936.246 331.56h-63.298v116.748h-75.957V779.56H674v-79.472L884.991 404h75.957v312.264h63.298v63.296zM735.89 716.264h149.1V499.648h-1.406L735.89 716.264z"
							p-id="1788"></path>
					</svg>
				</button>
				<!-- h5 -->
				<button @click="editor.chain().focus().toggleHeading({ level: 5 }).run()"
					:class="{ 'is-active': editor.isActive('heading', { level: 5 }) }">
					<svg t="1693116665930" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="12701" width="20" height="20">
						<path
							d="M742.89 394h254.597v71.736H802.672l-25.32 125.187 1.407 1.407c10.784-12.19 24.499-21.45 41.144-27.78 16.645-6.33 33.172-9.495 49.583-9.495 24.381 0 46.183 4.102 65.407 12.308 19.224 8.205 35.4 19.692 48.528 34.461 13.129 14.77 23.092 32.235 29.89 52.396 6.8 20.161 10.198 41.963 10.198 65.406 0 19.693-3.164 39.971-9.494 60.836-6.33 20.864-16.41 39.853-30.242 56.967-13.832 17.113-31.532 31.179-53.1 42.197-21.568 11.019-47.355 16.528-77.363 16.528-23.913 0-46.067-3.165-66.463-9.495-20.396-6.33-38.33-15.824-53.802-28.483-15.473-12.66-27.78-28.25-36.924-46.77-9.143-18.52-14.183-40.204-15.121-65.054h80.177c2.344 26.725 11.487 47.238 27.429 61.538 15.941 14.3 37.04 21.45 63.297 21.45 16.88 0 31.18-2.812 42.902-8.439 11.721-5.626 21.216-13.362 28.484-23.209 7.267-9.846 12.425-21.333 15.472-34.461 3.048-13.129 4.572-27.194 4.572-42.198 0-13.597-1.876-26.608-5.627-39.033-3.75-12.425-9.377-23.326-16.879-32.703-7.502-9.378-17.231-16.88-29.187-22.506-11.956-5.626-25.905-8.44-41.847-8.44-16.88 0-32.703 3.165-47.473 9.495-14.77 6.33-25.436 18.169-32 35.517h-80.177L742.891 394zM88 448h400V172c0-24.3 19.7-44 44-44s44 19.7 44 44v680c0 24.3-19.7 44-44 44s-44-19.7-44-44V536H88v316c0 24.3-19.7 44-44 44S0 876.3 0 852V172c0-24.3 19.7-44 44-44s44 19.7 44 44v276z"
							p-id="12702"></path>
					</svg>
				</button>
				<!-- h6 -->
				<button @click="editor.chain().focus().toggleHeading({ level: 6 }).run()"
					:class="{ 'is-active': editor.isActive('heading', { level: 6 }) }">
					<svg t="1693116723112" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="12855" width="20" height="20">
						<path
							d="M88 448h400V172c0-24.3 19.7-44 44-44s44 19.7 44 44v680c0 24.3-19.7 44-44 44s-44-19.7-44-44V536H88v316c0 24.3-19.7 44-44 44S0 876.3 0 852V172c0-24.3 19.7-44 44-44s44 19.7 44 44v276z m846.736 70.33c-1.875-20.162-9.02-36.454-21.438-48.88-12.417-12.424-29.169-18.637-50.255-18.637-14.526 0-27.06 2.696-37.603 8.088-10.544 5.392-19.446 12.542-26.71 21.45-7.262 8.91-13.12 19.107-17.571 30.594-4.452 11.487-8.083 23.56-10.895 36.22-2.811 12.66-4.803 25.201-5.974 37.626a4794.582 4794.582 0 0 1-3.163 34.813l1.406 1.407c10.777-19.692 25.654-34.344 44.632-43.956 18.978-9.612 39.478-14.418 61.501-14.418 24.366 0 46.155 4.22 65.367 12.66 19.212 8.44 35.495 20.044 48.85 34.813 13.354 14.77 23.545 32.234 30.574 52.395 7.029 20.162 10.543 41.964 10.543 65.407 0 23.912-3.866 46.066-11.597 66.462-7.732 20.395-18.86 38.212-33.387 53.45-14.526 15.238-31.863 27.077-52.012 35.517C906.855 891.78 884.598 896 860.232 896c-36.081 0-65.719-6.681-88.913-20.044-23.195-13.363-41.47-31.648-54.824-54.857-13.355-23.209-22.609-50.403-27.763-81.583-5.155-31.18-7.732-64.82-7.732-100.923 0-29.538 3.163-59.31 9.489-89.318 6.326-30.008 16.751-57.319 31.277-81.934 14.526-24.616 33.62-44.66 57.284-60.132C802.714 391.736 831.882 384 866.557 384c19.68 0 38.19 3.282 55.527 9.846 17.338 6.564 32.683 15.707 46.038 27.429 13.355 11.721 24.249 25.787 32.683 42.198 8.435 16.41 13.12 34.695 14.058 54.857h-80.127zM857.42 829.187c14.526 0 27.178-2.93 37.955-8.791 10.777-5.861 19.797-13.48 27.06-22.858 7.263-9.377 12.652-20.278 16.166-32.703 3.515-12.425 5.272-25.201 5.272-38.33 0-13.128-1.757-25.787-5.272-37.978-3.514-12.19-8.903-22.857-16.166-32-7.263-9.142-16.283-16.527-27.06-22.153-10.777-5.627-23.429-8.44-37.955-8.44s-27.295 2.696-38.306 8.088c-11.012 5.392-20.266 12.66-27.764 21.802-7.497 9.143-13.12 19.81-16.868 32-3.75 12.19-5.623 25.084-5.623 38.681 0 13.598 1.874 26.491 5.623 38.682 3.748 12.19 9.371 23.091 16.868 32.703 7.498 9.612 16.752 17.23 27.764 22.857 11.011 5.627 23.78 8.44 38.306 8.44z"
							p-id="12856"></path>
					</svg>
				</button>
				<!-- 无序列表 -->
				<button @click="editor.chain().focus().toggleBulletList().run()"
					:class="{ 'is-active': editor.isActive('bulletList') }">
					<svg t="1693117355867" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="8729" width="30" height="30">
						<path
							d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM912 476H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM912 760H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"
							p-id="8730"></path>
						<path d="M160 228m-56 0a56 56 0 1 0 112 0 56 56 0 1 0-112 0Z" p-id="8731"></path>
						<path d="M160 512m-56 0a56 56 0 1 0 112 0 56 56 0 1 0-112 0Z" p-id="8732"></path>
						<path d="M160 796m-56 0a56 56 0 1 0 112 0 56 56 0 1 0-112 0Z" p-id="8733"></path>
					</svg>
				</button>
				<!-- 有序列表 -->
				<button @click="editor.chain().focus().toggleOrderedList().run()"
					:class="{ 'is-active': editor.isActive('orderedList') }">
					<svg t="1693117280087" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="8575" width="30" height="30">
						<path
							d="M920 760H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM920 192H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM920 476H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM216 712H100c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h72.4v20.5h-35.7c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h35.7V838H100c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h116c2.2 0 4-1.8 4-4V716c0-2.2-1.8-4-4-4zM100 188h38v120c0 2.2 1.8 4 4 4h40c2.2 0 4-1.8 4-4V152c0-4.4-3.6-8-8-8h-78c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4zM216 428H100c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4h68.4l-70.3 77.7c-1.3 1.5-2.1 3.4-2.1 5.4V592c0 2.2 1.8 4 4 4h116c2.2 0 4-1.8 4-4v-36c0-2.2-1.8-4-4-4h-68.4l70.3-77.7c1.3-1.5 2.1-3.4 2.1-5.4V432c0-2.2-1.8-4-4-4z"
							p-id="8576"></path>
					</svg>
				</button>
				<!-- 块引用 -->
				<button @click="editor.chain().focus().toggleBlockquote().run()"
					:class="{ 'is-active': editor.isActive('blockquote') }">
					<svg t="1693117443196" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="9796" width="20" height="20">
						<path
							d="M235.710908 565.365418c3.442402-99.843986 20.061918-175.8521 49.92097-228.089835 29.827329-52.206012 76.305897-91.50097 139.435703-117.916597L349.324502 98.858542c-104.442724 47.073108-180.749644 116.493178-228.948389 208.29193C83.631234 376.007723 65.290517 487.336274 65.290517 641.107473l0 284.032962 332.234777 0L397.525294 565.365418 235.710908 565.365418zM769.351787 565.365418c3.442402-99.843986 20.061918-175.8521 49.92097-228.089835 29.827329-52.206012 76.305897-91.50097 139.435703-117.916597L882.965381 98.858542c-104.442724 47.073108-180.749644 116.493178-228.948389 208.29193-36.744879 68.857251-55.085596 180.185802-55.085596 333.957001l0 284.032962 332.234777 0L931.166173 565.365418 769.351787 565.365418z"
							p-id="9797"></path>
					</svg>
				</button>
				<!-- 水平分割线 -->
				<button @click="editor.chain().focus().setHorizontalRule().run()">
					<svg t="1693117500657" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="10783" width="20" height="20">
						<path
							d="M908.8 399.36H112A97.28 97.28 0 0 1 14.72 302.08V97.92a32.64 32.64 0 0 1 64 0v204.16a32 32 0 0 0 32 32H908.8a32 32 0 0 0 32-32V97.92a32.64 32.64 0 0 1 64 0v204.16a97.92 97.92 0 0 1-96 97.28zM973.44 942.08a32.64 32.64 0 0 1-32.64-32.64V704a32 32 0 0 0-32-32H112a32 32 0 0 0-32 32v204.16a32.64 32.64 0 0 1-64 0V704a97.28 97.28 0 0 1 96-96H908.8a97.92 97.92 0 0 1 97.28 96v204.16a32.64 32.64 0 0 1-32.64 33.92zM864.64 538.88L155.52 533.76a33.28 33.28 0 0 1-32-33.28 32 32 0 0 1 32.64-32l708.48 5.12a33.92 33.92 0 0 1 32.64 33.28 32 32 0 0 1-32.64 32z"
							fill="#323333" p-id="10784"></path>
					</svg>
				</button>
				<!-- 强制回车 -->
				<button @click="editor.chain().focus().setHardBreak().run()">
					<svg t="1693117559112" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="12634" width="20" height="20">
						<path
							d="M793.3 191.8h-185c-17.7 0-32 14.3-32 32s14.3 32 32 32h184.9c4.6 0 8.4 3.8 8.4 8.4v303.1c0 4.6-3.8 8.4-8.4 8.4h-507L458 403.9c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L213.2 558.3c-13.1 13.1-20.3 30.5-20.3 49s7.2 35.9 20.3 49l201.4 201.4c6.2 6.2 14.4 9.4 22.6 9.4 8.2 0 16.4-3.1 22.6-9.4 12.5-12.5 12.5-32.8 0-45.3L287.2 639.7h506.1c39.9 0 72.4-32.5 72.4-72.4V264.2c0-39.9-32.5-72.4-72.4-72.4z"
							p-id="12635"></path>
					</svg>
				</button>
				<!-- 撤销（undo） -->
				<button @click="editor.chain().focus().undo().run()" :disabled="!editor.can().chain().focus().undo().run()">
					<svg t="1693117683006" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="3472" width="20" height="20">
						<path
							d="M896.512 229.888C814.336 147.712 705.024 102.4 588.8 102.4s-225.536 45.2608-307.712 127.488S153.6 421.376 153.6 537.6v66.2016L43.7248 493.9264a25.6 25.6 0 0 0-36.1984 36.1984l153.6 153.6a25.4976 25.4976 0 0 0 36.2496 0l153.6-153.6a25.6 25.6 0 0 0-36.1984-36.1984l-109.8752 109.8752V537.6c0-211.7632 172.2368-384 384-384s384 172.2368 384 384-172.2368 384-384 384a25.6 25.6 0 0 0 0 51.2c116.224 0 225.536-45.2608 307.712-127.488s127.488-191.488 127.488-307.712c0-116.224-45.2608-225.536-127.488-307.712z"
							fill="" p-id="3473"></path>
					</svg>
				</button>
				<!-- 重做（redo） -->
				<button @click="editor.chain().focus().redo().run()" :disabled="!editor.can().chain().focus().redo().run()">
					<svg t="1693117714543" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="3626" width="20" height="20">
						<path
							d="M127.5904 229.888C209.7664 147.712 319.0784 102.4 435.3024 102.4s225.536 45.2608 307.712 127.488S870.5024 421.376 870.5024 537.6v66.2016l109.8752-109.8752a25.6 25.6 0 0 1 36.1984 36.1984l-153.6 153.6a25.4976 25.4976 0 0 1-36.2496 0l-153.6-153.6a25.6 25.6 0 0 1 36.1984-36.1984l109.8752 109.8752V537.6c0-211.7632-172.2368-384-384-384s-384 172.2368-384 384 172.2368 384 384 384a25.6 25.6 0 0 1 0 51.2c-116.224 0-225.536-45.2608-307.712-127.488s-127.488-191.488-127.488-307.712c0-116.224 45.2608-225.536 127.488-307.712z"
							fill="" p-id="3627"></path>
					</svg>
				</button>
				<!-- 全屏/退出全屏 -->
				<button @click="switchFullScreen">
					<svg v-if="!fullScreen" t="1693117914812" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="3618" width="20" height="20">
						<path
							d="M149.333333 394.666667c17.066667 0 32-14.933333 32-32v-136.533334l187.733334 187.733334c6.4 6.4 14.933333 8.533333 23.466666 8.533333s17.066667-2.133333 23.466667-8.533333c12.8-12.8 12.8-32 0-44.8l-187.733333-187.733334H362.666667c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32H149.333333c-4.266667 0-8.533333 0-10.666666 2.133334-8.533333 4.266667-14.933333 10.666667-19.2 17.066666-2.133333 4.266667-2.133333 8.533333-2.133334 12.8v213.333334c0 17.066667 14.933333 32 32 32zM874.666667 629.333333c-17.066667 0-32 14.933333-32 32v136.533334L642.133333 597.333333c-12.8-12.8-32-12.8-44.8 0s-12.8 32 0 44.8l200.533334 200.533334H661.333333c-17.066667 0-32 14.933333-32 32s14.933333 32 32 32h213.333334c4.266667 0 8.533333 0 10.666666-2.133334 8.533333-4.266667 14.933333-8.533333 17.066667-17.066666 2.133333-4.266667 2.133333-8.533333 2.133333-10.666667V661.333333c2.133333-17.066667-12.8-32-29.866666-32zM381.866667 595.2l-200.533334 200.533333V661.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v213.333334c0 4.266667 0 8.533333 2.133334 10.666666 4.266667 8.533333 8.533333 14.933333 17.066666 17.066667 4.266667 2.133333 8.533333 2.133333 10.666667 2.133333h213.333333c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32h-136.533333l200.533333-200.533333c12.8-12.8 12.8-32 0-44.8s-29.866667-10.666667-42.666666 0zM904.533333 138.666667c0-2.133333 0-2.133333 0 0-4.266667-8.533333-10.666667-14.933333-17.066666-17.066667-4.266667-2.133333-8.533333-2.133333-10.666667-2.133333H661.333333c-17.066667 0-32 14.933333-32 32s14.933333 32 32 32h136.533334l-187.733334 187.733333c-12.8 12.8-12.8 32 0 44.8 6.4 6.4 14.933333 8.533333 23.466667 8.533333s17.066667-2.133333 23.466667-8.533333l187.733333-187.733333V362.666667c0 17.066667 14.933333 32 32 32s32-14.933333 32-32V149.333333c-2.133333-4.266667-2.133333-8.533333-4.266667-10.666666z"
							fill="#666666" p-id="3619"></path>
					</svg>
					<svg v-else t="1693117942330" class="icon" viewBox="0 0 1024 1024" version="1.1"
						xmlns="http://www.w3.org/2000/svg" p-id="3828" width="20" height="20">
						<path
							d="M313.6 358.4H177.066667c-17.066667 0-32 14.933333-32 32s14.933333 32 32 32h213.333333c4.266667 0 8.533333 0 10.666667-2.133333 8.533333-4.266667 14.933333-8.533333 17.066666-17.066667 2.133333-4.266667 2.133333-8.533333 2.133334-10.666667v-213.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v136.533333L172.8 125.866667c-12.8-12.8-32-12.8-44.8 0-12.8 12.8-12.8 32 0 44.8l185.6 187.733333zM695.466667 650.666667H832c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32H618.666667c-4.266667 0-8.533333 0-10.666667 2.133333-8.533333 4.266667-14.933333 8.533333-17.066667 17.066667-2.133333 4.266667-2.133333 8.533333-2.133333 10.666666v213.333334c0 17.066667 14.933333 32 32 32s32-14.933333 32-32v-136.533334l200.533333 200.533334c6.4 6.4 14.933333 8.533333 23.466667 8.533333s17.066667-2.133333 23.466667-8.533333c12.8-12.8 12.8-32 0-44.8l-204.8-198.4zM435.2 605.866667c-4.266667-8.533333-8.533333-14.933333-17.066667-17.066667-4.266667-2.133333-8.533333-2.133333-10.666666-2.133333H192c-17.066667 0-32 14.933333-32 32s14.933333 32 32 32h136.533333L128 851.2c-12.8 12.8-12.8 32 0 44.8 6.4 6.4 14.933333 8.533333 23.466667 8.533333s17.066667-2.133333 23.466666-8.533333l200.533334-200.533333V832c0 17.066667 14.933333 32 32 32s32-14.933333 32-32V618.666667c-2.133333-4.266667-2.133333-8.533333-4.266667-12.8zM603.733333 403.2c4.266667 8.533333 8.533333 14.933333 17.066667 17.066667 4.266667 2.133333 8.533333 2.133333 10.666667 2.133333h213.333333c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32h-136.533333L896 170.666667c12.8-12.8 12.8-32 0-44.8-12.8-12.8-32-12.8-44.8 0l-187.733333 187.733333V177.066667c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v213.333333c2.133333 4.266667 2.133333 8.533333 4.266666 12.8z"
							fill="#666666" p-id="3829"></path>
					</svg>
				</button>
			</div>


		</div>
		<div class="document-title">{{ docName }}</div>
		<!-- <editor-content :editor="editor" id="document-content" v-model="localContent"
			@update="$emit('update:docContent', editor.storage.content)" /> -->
			<div class="flex">
				<editor-content :editor="editor" id="document-content" />
				<slot v-if="showHistoryVersion" name="version"></slot>
			</div>
		
		<div id="hidden-area"></div>
		<div class="document-words">
			{{ editor.storage.characterCount.words() }} 个单词
			<div class="document-characters">{{ editor.storage.characterCount.characters() }} / {{ docLimit }} 个字符
				{{ editor.storage.collaborationCursor.users.length }}人正在编辑该文档
			</div>
		</div>
	</div>
</template>

<script>
import StarterKit from '@tiptap/starter-kit'
import CharactorCount from '@tiptap/extension-character-count'
import Document from '@tiptap/extension-document'
import Underline from '@tiptap/extension-underline'
import FontFamily from '@tiptap/extension-font-family'
import Typography from '@tiptap/extension-typography'//实时渲染markdown
import Highlight from '@tiptap/extension-highlight'//文本高亮
import Placeholder from '@tiptap/extension-placeholder'
import { Color } from '@tiptap/extension-color'
import Mention from '@tiptap/extension-mention'
import TaskItem from '@tiptap/extension-task-item'
import TaskList from '@tiptap/extension-task-list'
import Text from '@tiptap/extension-text'
import TextStyle from '@tiptap/extension-text-style'
import TextAlign from '@tiptap/extension-text-align'
import { lowlight } from 'lowlight'//代码高亮
import CodeBlockLowLight from '@tiptap/extension-code-block-lowlight'//代码高亮
import { Editor, EditorContent, BubbleMenu, FloatingMenu } from '@tiptap/vue-3'
//协作重要插件
import * as Y from 'yjs'
import { HocuspocusProvider } from '@hocuspocus/provider'
import Collaboration from '@tiptap/extension-collaboration'
import CollaborationCursor from '@tiptap/extension-collaboration-cursor'
//将文档下载到本地
import exportWord from 'js-export-word'
import html2canvas from 'html2canvas'
import JsPDF from 'jspdf'

// @
import { VueRenderer } from '@tiptap/vue-3'
import tippy from 'tippy.js'
import MentionList from './MentionList.vue'
import Suggestion from '@tiptap/suggestion'

// color picker
import { NColorPicker } from 'naive-ui'

export default {
	name: 'TextEditor',
	components: {
		EditorContent,
		BubbleMenu,
		FloatingMenu,
		NColorPicker
	},
	props: {
		showHistoryVersion: {
			type: Boolean,
			default: false,
		},
		docId: {
			type: String,
			default: '1'
		},
		docName: {
			type: String,
			default: 'temp'
		},
		docContent: {
			type: String,
		},
		isReadOnly: {
			type: Boolean
		}
	},
	emits: ['update:docContent', 'updateVersion'],
	data() {
		return {
			userAvatar: '/src/assets/avatar.jpeg',
			// localContent: '',
			docLimit: 100000,
			autoSavePeriod: 10000,
			editable: false,
			fullScreen: false,
			editor: undefined,
			selectedFontFamily: 'sans-serif',
			selectedFontSize: '',
			provider: undefined,
			fontOptions: [
				{ value: 'consolas', label: 'consolas' },
				{ value: 'monospace', label: 'monospace' },
				{ value: 'cascadia code', label: 'cascadia code' },
				{ value: 'Arial', label: 'Arial' },
				{ value: 'Courier', label: 'Courier' },
				{ value: 'Courier new', label: 'Courier new' },
				{ value: 'PingFang SC', label: 'PingFang SC' },
				{ value: 'sans-serif', label: 'sans-serif' },
				{ value: 'Inter', label: 'Inter' },
				{ value: 'Comic Sans MS, Comic Sans', label: 'Comic Sans' },
				{ value: 'serif', label: 'serif' },
				{ value: 'monospace', label: 'monospace' },
				{ value: 'cursive', label: 'cursive' },
				{ value: 'Times New Roman', label: 'Times New Roman' }
			],
		}
	},
	updated() {
		// this.clearColorPickerText()
	},
	methods: {
		clearColorPickerText() {
			const div = document.getElementsByClassName('n-color-picker-trigger__value')
			if (div) {
				div[0].innerHTML = ''
			}
		},
		//为协作光标获取随机颜色
		getRandomColor() {
			const letters = '0123456789ABCDEF';
			let color = '#';

			for (let i = 0; i < 6; i++) {
				color += letters[Math.floor(Math.random() * 16)];
			}
			return color;
		},
		//根据亮度匹配协作光标的字体颜色
		getFontColor(background) {
			// 将背景颜色转换为RGB格式
			const r = parseInt(background.substr(1, 2), 16);
			const g = parseInt(background.substr(3, 2), 16);
			const b = parseInt(background.substr(5, 2), 16);

			// 计算亮度（根据公式 Y = 0.299*R + 0.587*G + 0.114*B）
			const brightness = (0.299 * r + 0.587 * g + 0.114 * b) / 255;

			// 根据亮度选择字体颜色
			const fontColor = brightness > 0.5 ? '#444' : '#eee';

			return fontColor;
		},

		//更改字体
		changeFont() {
			this.editor.chain().focus().setFontFamily(this.selectedFontFamily || 'unset').run()
		},
		exportAsPDF() {
			let original = document.querySelector('#document-content')
			let page = original.cloneNode(true)//需要对原样式进行一些修改，因此深拷贝

			//修改样式和显示内容
			page.querySelectorAll('.ProseMirror').forEach(element => {
				element.style.backgroundColor = 'white';
			});
			page.querySelectorAll('.collaboration-cursor__caret, .collaboration-cursor__label').forEach(element => {
				element.style.display = 'none';
			});
			original.style.display = 'none'//隐藏显示
			document.querySelector('#hidden-area').appendChild(page)

			const docName = this.docName
			let abs = 0
			let innerWidth = document.documentElement.clientWidth || document.body.clientWidth // 获得当前可视窗口的宽度（不包含滚动条）
			let outerWidth = window.innerWidth // 获得当前窗口的宽度（包含滚动条）
			if (outerWidth > innerWidth) {
				abs = (outerWidth - innerWidth) / 2    // 获得滚动条宽度的一半
			}
			html2canvas(page, {
				dpi: 300,
				useCORS: true  //允许canvas画布内 可以跨域请求外部链接图片, 允许跨域请求。
			}).then((canvas) => {
				let pdf = new JsPDF('p', 'mm', 'a4')    //A4纸，纵向
				let ctx = canvas.getContext('2d')
				let a4w = 190, a4h = 277    //A4大小，210mm x 297mm，四边各保留10mm的边距，显示区域190x277
				let imgHeight = Math.floor(a4h * canvas.width / a4w)    //按A4显示比例换算一页图像的像素高度
				let renderedHeight = 0

				while (renderedHeight < canvas.height) {
					let page = document.createElement("canvas")
					page.width = canvas.width
					page.height = Math.min(imgHeight, canvas.height - renderedHeight)//可能内容不足一页
					//用getImageData剪裁指定区域，并画到前面创建的canvas对象中
					page.getContext('2d').putImageData(ctx.getImageData(0, renderedHeight, canvas.width, Math.min(imgHeight, canvas.height - renderedHeight)), 0, 0)
					pdf.addImage(page.toDataURL('image/jpeg', 1.0), 'JPEG', 10, 10, a4w, Math.min(a4h, a4w * page.height / page.width))    //添加图像到页面，保留10mm边距
					renderedHeight += imgHeight
					if (renderedHeight < canvas.height)
						pdf.addPage()//如果后面还有内容，添加一个空页
				}
				pdf.save(docName)
			}).then(() => {
				original.style.display = 'block'//恢复显示
				document.querySelector('#hidden-area').removeChild(page)
				console.log('成功保存为PDF')
			})
		},
		exportAsWord() {
			exportWord(document.querySelector('#document-content'), {
				addStyle: true,
				fileName: this.docName,
				// toImg: [],
				// success() {}
			})
		},
		switchFullScreen() {
			if (document.fullscreenElement === null) {
				document.getElementById('editor-wrapper').requestFullscreen()
				console.log('进入全屏')
				this.fullScreen = true
			} else {
				document.exitFullscreen()
				console.log('退出全屏')
				this.fullScreen = false
			}
		},
		saveDocument(mode) {
			let formData = new FormData()
			formData.append('source', this.editor.getHTML())
			if (mode === 'manualsave') {
				this.$http.post(`/api/projects/file/${this.docId}/store/`, formData).then(() => {
					console.log('保存成功')
					this.$emit('updateVersion')
				})
			} else {
				this.$http.post(`/api/projects/file/${this.docId}/autostore/`, formData).then(() => {
					console.log('自动保存成功')
				})
			}
		}
	},
	watch: {
		editable() {
			this.editor.setEditable(this.editable)
		},
		docContent() {
			this.editor.commands.setContent(this.docContent)
		},
		selectedFontFamily(newValue) {
			if (newValue === '') {
				this.selectedFontFamily = 'sans-serif'
			}
		}
	},
	mounted() {
		const yDOC = new Y.Doc()//协作文档载体
		this.provider = new HocuspocusProvider({//用户端
			url: 'ws://43.138.14.231:1234',
			//文档的标识对应一个 yDoc 属性
			name: String(this.docId),
			document: yDOC,
		})
		//加载保存时间最近的文件,然后初始化编辑器
		//查询团队成员,然后初始化编辑器
		this.$http.get(`/api/teams/${this.$cookies.get('teamId')}/`).then((response) => {
			let identityMap = {
				'leader': '团队创建者',
				'admin': '团队管理员',
				'member': '团队成员'
			}
			this.members = response.data.members.map(element => {
				return {
					docId: this.docId,
					id: element.user.id,
					username: element.user.username,
					identity: identityMap[element.identity]
				}
			})
		})
		this.editor = new Editor({
			extensions: [
				Document,
				Mention.configure({
					HTMLAttributes: {
						class: 'mention',
					},
					suggestion: {
						items: () => { return this.members },
						render: () => {
							let component
							let popup
							return {

								onStart: props => {
									component = new VueRenderer(MentionList, {
										props,
										editor: props.editor,
									})

									if (!props.clientRect()) {
										return
									}

									popup = tippy('body', {
										getReferenceClientRect: props.clientRect,
										appendTo: () => document.body,
										content: component.element,
										showOnCreate: true,
										interactive: true,
										trigger: 'manual',
										placement: 'bottom-start',
									})
								},

								onUpdate(props) {
									component.updateProps(props)
									if (!props.clientRect()) {
										return
									}
									popup[0].setProps({
										getReferenceClientRect: props.clientRect,
									})
								},

								onKeyDown(props) {
									if (props.event.key === 'Escape') {
										popup[0].hide()
										return true
									}

									return component.ref?.onKeyDown(props)
								},

								onExit() {
									popup[0].destroy()
									component.destroy()
								},
							}
						}
					}
				}),
				StarterKit.configure({
					history: false//使用collaboration的history
				}),
				CharactorCount.configure({
					limit: this.docLimit
				}),
				Collaboration.configure({
					document: yDOC
				}),
				CollaborationCursor.configure({
					provider: this.provider,
					user: {
						name: this.$cookies.get('username'),
						color: this.getRandomColor(),
						avatar: this.userAvatar
					}
				}),
				Typography,
				Underline,
				Color,
				FontFamily,
				TaskList,
				TaskItem.configure({
					nested: true,
				}),
				Text,
				TextStyle,
				TextAlign.configure({
					types: ['heading', 'paragraph'],
				}),
				CodeBlockLowLight.configure({
					lowlight,
				}),
				Placeholder.configure(
					{
						placeholder: ({ node }) => {
							return '从这里开始编写文档 支持Markdown快捷键'
						}
					}
				),
				Highlight.configure({
					multicolor: true
				})
			],
			// content: '',
			editable: this.editable,
			onSelectionUpdate: () => {
				let selected = window.getSelection()
				if (selected.rangeCount !== 0) {
					let range = selected.getRangeAt(0)
					let node = range.commonAncestorContainer
					if (node.nodeType != 1) {
						node = node.parentNode
					}
					this.selectedFontSize = window.getComputedStyle(node).getPropertyValue('font-size')
					this.selectedFontFamily = window.getComputedStyle(node).getPropertyValue('font-family')
				}
			},
		})
		//设置自动保存
		setInterval(() => {
			this.saveDocument('autosave')
		}, this.autoSavePeriod)
		this.editor.commands.clearContent()
		//当provider连接上时的设置
		this.provider.on('status', event => {
			if (event.status === 'connected') {
				this.editor.commands.clearContent()
			}
		})
		//只有没有人在同时编辑的时候才加载，否则使用正在共享编辑的版本
		//好像并不需要，后端还是能保存一段时间？
		// setTimeout(() => {
		// 	if (this.editor.storage.collaborationCursor.users.length === 1 && this.editor.storage.content === '<p></p>') {
		// 		console.log('插入保存的内容' + this.editor.storage.collaborationCursor.users.length)
		// 		this.editor.commands.clearContent()
		// 		setTimeout(() => {
		// 			this.editor.commands.setContent(this.docContent)
		// 		}, 100)
		// 	}
		// }, 1000)
		//修改协作光标的文字颜色
		document.querySelectorAll('.ProseMirror .collaboration-cursor__label').forEach(elm => {
			elm.style.color = this.getFontColor(elm.style.backgroundColor)
		})
	},
	beforeUnmount() {

	},
}

</script>

<style>
::selection {
	background: lightgray;
}


/* 最外层盒子 */
#editor-wrapper {
	position: relative;
	/* margin: 0 10px; */
	background: rgb(240, 240, 240);
	width: 100%;
	/* width: 80%; */
	/* margin: 0 auto; */
}


/* 颜色选择按钮样式 */
.color-input {
	/* padding: 3px 5px; */
	/* margin: 3px 5px; */
	display: inline-block;
	width: 23px;
	display: flex;
	justify-content: center;
	align-items: center;
	cursor: pointer;
	/* height: 30px; */
	/* border-radius: 30px;
	overflow: hidden; */
}


/* 气泡菜单样式 */
.editor-bubble-menu {
	border-radius: 5px;
	background: #616161;
	width: fit-content;
	white-space: nowrap;
}

.editor-floating-menu {
	border-radius: 5px;
	background: #777;
	width: fit-content;
	white-space: nowrap;
}

/* 气泡菜单按钮样式 */
.editor-bubble-menu button {
	padding: 3px 5px;
	margin: 3px 5px;
	border-radius: 2px;
	background: #ddd;
	color: #616161;
	transition: all linear 0.2s;
	cursor: pointer;
}

.editor-floating-menu button {
	padding: 3px 5px;
	margin: 3px 5px;
	border-radius: 2px;
	background: #ddd;
	color: #616161;
	transition: all linear 0.2s;
	cursor: pointer;
}

/* 工具栏按钮样式 */
.editor-bar {
	position: sticky;
	top: 0;
	height: 100px;
	z-index: 10;
	background: rgb(245, 245, 245);
	border-bottom: 1px solid lightgrey;
	display: flex;
	/* flex-wrap: wrap; */
}

.editor-bar .saves {
	display: flex;
	align-items: center;
}

.editor-bar .saves button {
	margin-right: 5px;
	padding: 0;
	height: 70px;
}

.editor-bar .font {
	width: 230px;
	flex: none;
	display: flex;
	flex-wrap: wrap;
	align-content: center;
}

.editor-bar .font-top {
	display: flex;
	width: 100%;
	justify-content: space-evenly;
	align-items: center;
	margin-bottom: 5px;
}

.editor-bar .font-bottom {
	display: flex;
	width: 100%;
	justify-content: space-evenly;
}

.color-input input {
	border-radius: 5px;
	cursor: pointer;
}

.editor-bar .font-bottom button {
	width: 35px;
	height: 35px;
	display: flex;
	justify-content: center;
	align-items: center;
	margin: 0;
}

.editor-bar button {
	border-radius: 3px;
	background: #ddd;
	color: #616161;
	padding: 5px 10px;
	margin: 5px 10px;
	transition: all linear 0.2s;
	cursor: pointer;
}

.editor-bar button:hover {
	transform: scale(1.05);
}

.editor-bubble-menu button:hover {
	transform: scale(1.05);
}

/* 加粗等按钮为激活状态时的样式 */
.editor-bar button.is-active {
	background: #616161;
	color: #ddd;
	font-weight: 700;
}

.editor-bar button[disabled="true"] {
	opacity: 0.5;
}

/* 文档字数和单词统计 */
.document-words {
	position: fixed;
	bottom: 0;
	left: 10px;
}

.document-characters {
	display: inline-block;
	padding-left: 10px;
	border-left: 1px solid rgba(199,29,35, 1);
	/* position: sticky;
	bottom: 0;
	left: 0; */
}

/* 文档标题 */
.document-title {
	margin-top: 20px;
	text-align: center;
	font-size: 40px;
	font-weight: 700;
}

/* 编辑器内容区 */
#document-content {
	/* padding: 20px; */
	overflow: auto;
}


.ProseMirror {
	min-height: 700px;
	/* width: 60%; */
	min-width: 700px;
	caret-color: rgba(199, 29, 35, 1);
	/* margin: 0 auto; */
	padding: 100px;
	border: 1px solid lightgrey;
	box-sizing: border-box;
	box-shadow: 0 0 5px grey;
	background: white;
	/* line-height: 2; */
	border-radius: 5px;
	margin-top: 25px;
	/* background: #ccc; */
	white-space: normal;
	/* transition: all cubic-bezier(0.165, 0.84, 0.44, 1) 0.5s; */
}

.ProseMirror:hover {
	/* box-shadow: #666 3px 3px 3px 3px; */
	/* background: #ddd; */
	/* outline: #616161 1px solid; */
	/* margin-top: 10px; */
	/* transition: all cubic-bezier(0.165, 0.84, 0.44, 1) 0.5s; */
}

.ProseMirror:focus {
	/* margin-top: 0; */
	/* box-shadow: #666 5px 5px 5px 5px; */
	/* background: #fff; */
	/* outline: #616161 5px solid; */
	/* transition: all cubic-bezier(0.165, 0.84, 0.44, 1) 0.7s; */
}

.ProseMirror:focus-visible {
	outline: 0;
}

/* placeholder样式 */
.ProseMirror p.is-editor-empty:first-child::before {
	font-weight: 700;
	color: #777 !important
}

/* 加粗样式 */
.ProseMirror strong {
	font-weight: 700;
}

/* 倾斜样式 */
.ProseMirror em {
	font-style: italic;
}

/* 划掉样式 */
.ProseMirror s {
	text-decoration: line-through;
}

/* 下划线样式 */
.ProseMirror u {
	text-decoration: underline;
}


/* 一坨任务项样式 */
.ProseMirror ul[data-type="taskList"] {
	list-style: none;
	padding: 0;
}

.ProseMirror ul[data-type="taskList"] p {
	margin: 0;
}

.ProseMirror ul[data-type="taskList"] li {
	display: flex;
}

.ProseMirror ul[data-type="taskList"] li>label {
	flex: 0 0 auto;
	margin-right: 0.5rem;
	user-select: none;
}

.ProseMirror ul[data-type="taskList"] li div {
	flex: 1 1 auto;
}

.ProseMirror ul[data-type="taskList"] li ul li,
.ProseMirror ul[data-type="taskList"] li ol li {
	display: list-item;
}

.ProseMirror ul[data-type="taskList"] li ul[data-type="taskList"]>li {
	display: flex;
}

/* 各级标题 */
.ProseMirror h1,
.ProseMirror h1 span {
	font-size: 45px;
}

.ProseMirror h2,
.ProseMirror h2 span {
	font-size: 37px;
}

.ProseMirror h3,
.ProseMirror h3 span {
	font-size: 30px;
}

.ProseMirror h4,
.ProseMirror h4 span {
	font-size: 25px;
}

.ProseMirror h5,
.ProseMirror h5 span {
	font-size: 20px;
}

.ProseMirror h6,
.ProseMirror h6 span {
	font-size: 18px;
}

.ProseMirror h1,
.ProseMirror h2,
.ProseMirror h3,
.ProseMirror h4,
.ProseMirror h5,
.ProseMirror h6 {
	font-weight: 700;
}

/* placeholder样式 */
.tiptap p.is-editor-empty:first-child::before {
	color: #adb5bd;
	content: attr(data-placeholder);
	float: left;
	height: 0;
	pointer-events: none;
}

/* 块引用 */
.ProseMirror blockquote {
	display: inline-block;
	padding-left: 1rem;
	border-left: 3px solid #888;
}

/* 代码碎片文字样式 */
.ProseMirror code {
	font-size: 0.9em;
	padding: 0.25em;
	margin: 0 0.25em;
	border-radius: 0.25em;
	background: #ccc;
	color: #616161;
	font-family: monoca, cascadia code, monospace;
	box-decoration-break: clone;
}

.ProseMirror pre {
	background: #0D0D0D;
	color: #FFF;
	font-family: 'JetBrainsMono', monospace;
	padding: 0.75rem 1rem;
	border-radius: 0.5rem;
}


.ProseMirror pre code {
	color: inherit;
	padding: 0;
	background: none;
	font-size: 0.9em;
}

/* 代码块样式 */
.ProseMirror .hljs-comment,
.ProseMirror .hljs-quote {
	color: #616161;
}

.ProseMirror .hljs-variable,
.ProseMirror .hljs-template-variable,
.ProseMirror .hljs-attribute,
.ProseMirror .hljs-tag,
.ProseMirror .hljs-name,
.ProseMirror .hljs-regexp,
.ProseMirror .hljs-link,
.ProseMirror .hljs-name,
.ProseMirror .hljs-selector-id,
.ProseMirror .hljs-selector-class {
	color: #F98181;
}

.ProseMirror .hljs-number,
.ProseMirror .hljs-meta,
.ProseMirror .hljs-built_in,
.ProseMirror .hljs-builtin-name,
.ProseMirror .hljs-literal,
.ProseMirror .hljs-type,
.ProseMirror .hljs-params {
	color: #FBBC88;
}

.ProseMirror .hljs-string,
.ProseMirror .hljs-symbol,
.ProseMirror hljs-bullet {
	color: #B9F18D;
}

.ProseMirror .hljs-title,
.ProseMirror .hljs-section {
	color: #FAF594;
}

.ProseMirror .hljs-keyword,
.ProseMirror .hljs-selector-tag {
	color: #70CFF8;
}

.ProseMirror .hljs-emphasis {
	font-style: italic;
}

.ProseMirror .hljs-strong {
	font-weight: 700;
}

.ProseMirror img {
	max-width: 100%;
	height: auto;
}

.ProseMirror blockquote {
	padding-left: 1rem;
	border-left: 2px solid rgba(#0D0D0D, 0.1);
}

.ProseMirror hr {
	border: 2px solid rgba(#555);
	margin: 2rem 0;
}

/* 协作光标样式 */
.ProseMirror .collaboration-cursor__caret {
	border-left: 1px solid #0D0D0D;
	border-right: 1px solid #0D0D0D;
	margin-left: -1px;
	margin-right: -1px;
	pointer-events: none;
	position: relative;
	word-break: normal;
}

/* Render the username above the caret */
.ProseMirror .collaboration-cursor__label {
	border-radius: 3px 3px 3px 0;
	color: #eee;
	font-size: 12px;
	font-style: normal;
	font-weight: 600;
	left: -1px;
	line-height: normal;
	padding: 0.1rem 0.3rem;
	position: absolute;
	top: -1.4em;
	user-select: none;
	white-space: nowrap;
}

.font-select {
	display: inline-block;
	width: 155px;
	height: 30px;
	padding-left: 10px;
	border-radius: 5px;
	border: 1px solid lightgrey;
	color: rgba(199, 29, 35, 1);
	font-size: 14px;
}

.font-select:focus-visible {
	outline: 0;
	border: 3px solid rgba(199, 29, 35, 1);
}

.ProseMirror ul,
.ProseMirror ul li {
	list-style-type: circle;
}

.ProseMirror ol,
.ProseMirror ol li {
	list-style-type: decimal;
}

.temp-container {
	display: flex;
	width: 1200px;
	overflow-x: scroll;
}

.temp-container ul {
	max-height: 70px;
	overflow-y: auto;
	color: yellow
}

.flex {
	display: flex;
	justify-content: space-evenly;
	width: 100%
}
.flex div {
	flex: none;
}
</style>